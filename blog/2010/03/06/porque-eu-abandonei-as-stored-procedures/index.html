
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Porque eu abandonei as stored procedures - Temple Coding</title>
  <meta name="author" content="Thiago Temple">

  
  <meta name="description" content="OK, eu tenho que admitir, eu ainda não abandonei definitivamente as stored procedures, porque eu preciso dar manutenção em sistemas que as usam. Mas &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://templecoding.com/blog/2010/03/06/porque-eu-abandonei-as-stored-procedures">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Temple Coding" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><h1><a href="/">Temple Coding</a></h1>

<h2>código, tecnologia e outras nerdices</h2>


</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:templecoding.com" />
    <input class="search" type="text" name="q" placeholder="Procurar"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arquivos</a></li>
  <li><a href="/blog/categories/videocast">Videocast</a></li>
  <li><a href="/sobre">Sobre</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Porque eu abandonei as stored procedures</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-06T00:00:00-05:00"  data-updated="true">06/03/2010</time>
        
         | <a href="#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>OK, eu tenho que admitir, eu ainda não abandonei definitivamente as stored procedures, porque eu preciso dar manutenção em sistemas que as usam. Mas vou dizer porque eu prefiro de todas as formas não usar mais stored procedures.</p>


<p><strong>Lógica espalhada</strong></p>


<p>Stored procedures são um atrativo muito grande para se espalhar a lógica, o simples fato de você poder alterar uma stored procedure, executar no banco e pronto, torna isso muito, mas muito simples. Nesse caso, não precisamos compilar códigos, gerar pacotes de implantação, etc. Mas isso gera um problema muito grande, assim que passar um tempo, digamos, uns meses, semanas ou algumas horas (no caso de alguns), a gente já esqueceu que fizemos aquela regra de negócio (ou só aquele IFzinho) dentro da procedure, ou pior, se for algum novo desenvolvedor a dar manutenção no sistema ele vai demorar a entender que aquela lógica existia ali. Agora, imagine se esse novo desenvolvedor olha essa regra de negócio dentro da procedure e resolve fazer outra regra dentro de outra procedure só porque é mais simples e afinal de contas, outras pessoas fazem também. Pronto, está iniciada a colcha de retalhos.</p>


<p><strong>Testes unitários</strong></p>


<p>Stored procedures são difíceis de se testar unitariamente. Lógica de negócios em stored procedures é código que não é automaticamente testado de uma forma fácil. Eu sei que existem exceções e é possível testar stored procedures usando o nUnit por exemplo, mas eu entendo que testes unitários devem executar o mais rápido possível e devem testar apenas uma unidade de negócio. E testar stored procedures envolve mais do que isso.</p>


<p><strong>Ortogonalidade</strong></p>


<blockquote>
<p>&#8220;Quando componentes estão isolados uns dos outros, você sabe que pode mudar um sem ter que se preocupar com o resto.&#8221;</p>
<p>The Pragmatic Programmer</p>
</blockquote>


<p>Ortogonalidade significa independência ou desacoplamento. Mudança em uma coisa não implica em mudança em outra.</p>


<p>No caso das stored procedures isso é muito fácil de perceber, toda vez que você tiver que adicionar ou remover uma coluna/propriedade do seu código para INSERIR/ATUALIZAR/LISTAR alguma coisa você terá que alterar o código que chama a stored procedure e também a própria procedure, isso quebra dois principios dos programadores pragmáticos, a <strong>ortogonalidade</strong> porque você terá que alterar dois pontos e consequentemente terá quebrado o <a href="http://lucattelli.com/blog/?p=313" target="_blank">DRY</a>. Com a grande popularização dos <a href="http://en.wikipedia.org/wiki/List_of_object-relational_mapping_software" target="_blank">frameworks de ORM</a> é muito mais fácil manter essas camadas isoladas.</p>


<p><strong>A Exceção</strong></p>


<p>Existe um único caso em que eu abriria mão e usaria uma stored procedure, no caso do ganho de performace. Procedures ficam no cache dos servidores de banco de dados, ou seja, os bancos de dados já tem um plano de execução ?pensado? para essas procedures, já tem o código das procedures compilados, já sabe quais índices usar, etc. Mas esse ganho teria que ser muito grande, e em um caso onde a ação dentro da procedure fosse muito utilizada dentro do sistema, fazendo com que o benefício fosse realmente válido.</p>


<p><strong>Conclusão</strong></p>


<p>Talvez você esteja lendo esse texto e pensando que muito provavelmente o vilão da história não é a stored procedure e talvez o programador. Eu diria que são os dois, mas como não é possível controlar o que cada desenvolvedor vai fazer, principalmente no calor de um projeto, e analisar procedures é um trabalho que toma tempo (que dificilmente temos), é muito mais fácil declarar uma política que no projeto não deve haver stored procedures, com isso, eu tenho certeza, muitas dores de cabeça serão evitadas.</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Postado por <span class="fn">Thiago Temple</span></span>

      








  


<time datetime="2010-03-06T00:00:00-05:00"  data-updated="true">06/03/2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/desenvolvimento/'>Desenvolvimento</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://templecoding.com/blog/2010/03/06/porque-eu-abandonei-as-stored-procedures/" data-via="vintem12" data-counturl="http://templecoding.com/blog/2010/03/06/porque-eu-abandonei-as-stored-procedures/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/03/06/customizando-templates-no-asp-net-mvc2/" title="Previous Post: Customizando Templates no Asp.Net MVC2">&laquo; Customizando Templates no Asp.Net MVC2</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/03/23/sobre-janelas-quebradas/" title="Next Post: Sobre janelas quebradas">Sobre janelas quebradas &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comentários</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/26/publicando-um-site-octopress-usando-github-pages-em-uma-nova-maquina-de-dev/">Publicando um site Octopress usando GitHub pages a partir de um novo computador</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/25/instalando-uma-maquina-de-desenvolvimento-com-dois-comandos/">Instalando uma máquina de desenvolvimento com dois comandos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/30/responsabilidade-unica-com-javascript/">Só é uma bagunça se você deixar. Responsabilidade única com JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/23/meu-ted-talk-favorito/">Meu TED Talk favorito</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/16/programacao-orientada-a-coincidencia/">Programação orientada à coincidência</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Thiago Temple -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>


<script type="text/javascript">
var sc_project=5357260;
var sc_invisible=1;
var sc_security="14d7610a";
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" + scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web stats"
href="http://statcounter.com/free-web-stats/" target="_blank"><img
class="statcounter" src="http://c.statcounter.com/5357260/0/14d7610a/1/"
alt="web stats"></a></div></noscript>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'templecoding';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://templecoding.com/blog/2010/03/06/porque-eu-abandonei-as-stored-procedures/';
        var disqus_url = 'http://templecoding.com/blog/2010/03/06/porque-eu-abandonei-as-stored-procedures/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
