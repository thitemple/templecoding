<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: asp.net | Temple Coding]]></title>
  <link href="http://vintem.github.io/templecoding/blog/categories/asp-dot-net/atom.xml" rel="self"/>
  <link href="http://vintem.github.io/templecoding/"/>
  <updated>2013-09-03T10:42:11-04:00</updated>
  <id>http://vintem.github.io/templecoding/</id>
  <author>
    <name><![CDATA[Thiago Temple]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Localização de mensagem de erro no ASP.NET MVC]]></title>
    <link href="http://vintem.github.io/templecoding/blog/2010/07/22/localizao-de-mensagem-de-erro-no-asp-net-mvc/"/>
    <updated>2010-07-22T00:00:00-04:00</updated>
    <id>http://vintem.github.io/templecoding/blog/2010/07/22/localizao-de-mensagem-de-erro-no-asp-net-mvc</id>
    <content type="html"><![CDATA[<p>Sabe quando você preenche uma data inválida em uma página usando o ASP.NET MVC e o erro vem em inglês assim:</p>

<p><img class="aligncenter" src="/images/2010/07/ErroIngles_thumb.png" title="Erro em inglês" ></p>

<p>Isso acontece porque o DefaultModelBinder do MVC não conseguiu converter essa data, no caso acima, é óbvio porque não existe um mês 15. A questão é, como traduzir essa mensagem?</p>

<p>Um jeito que achei foi adicionando uma pasta App_GlobalResources e dentro dessa pasta adicionar um arquivo de resources, que no caso, chamei de CustomMvcResources.resx.</p>

<p><img class="aligncenter" src="/images/2010/07/ArquivoResources.png" title="Arquivo de Resources" ></p>

<p>Nesse arquivo de resources adicione a seguinte linha:</p>

<p><img class="aligncenter" src="/images/2010/07/ItemResource.png" title="Item do Resource" ></p>

<p>No global.asax altere o método Application_Start para que fique assim:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">()</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="n">AreaRegistration</span><span class="p">.</span><span class="n">RegisterAllAreas</span><span class="p">();</span>
</span><span class='line'><span class="n">DefaultModelBinder</span><span class="p">.</span><span class="n">ResourceClassKey</span> <span class="p">=</span> <span class="s">&quot;CustomMvcResources&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">RegisterRoutes</span><span class="p">(</span><span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">);</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>O importante é que o valor informado à propriedade ResourceClassKey tenha o nome do arquivo de resource criado.</p>

<p>Agora o erro será apresentado do jeito que foi configurado no arquivo de resources.</p>

<p><img class="aligncenter" src="/images/2010/07/ErroTraduzido.png" title="Erro traduzido" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Utilizando o Asp.Net MVC junto com Asp.Net WebForms]]></title>
    <link href="http://vintem.github.io/templecoding/blog/2009/11/14/utilizando-o-asp-net-mvc-junto-com-asp-net-webforms/"/>
    <updated>2009-11-14T00:00:00-05:00</updated>
    <id>http://vintem.github.io/templecoding/blog/2009/11/14/utilizando-o-asp-net-mvc-junto-com-asp-net-webforms</id>
    <content type="html"><![CDATA[<p>Para aqueles que como eu, gostaram muito da implementação do MVC para o Asp.Net (eu relutei no início, mas tive que ceder, ficou muito bom) e gostariam de começar a usá-lo já, mas não tem nenhum projeto novo pra implementá-lo, existe uma forma de utilizar o Asp.Net MVC junto com os costumeiros Web Forms.</p>

<p>A 1a coisa que você precisa verificar, obviamente, é se o servidor onde roda o seu site suporta o .Net Framework 3.5, já que o Asp.Net MVC precisa dessa versão.</p>

<p>1) Se o projeto foi feito no Visual Studio 2005 ou 2003, abra ele no Visual Studio 2008 e siga o wizard pra converter o projeto para o Visual Studio 2008.</p>

<p>2) Se o seu projeto for uma web application (que tem a pasta bin) pode pular essa etapa, se for um web site é preciso convertê-lo para um web application. Veja como aqui <a href="http://msdn.microsoft.com/en-us/library/aa983476.aspx" target="_blank"><a href="http://msdn.microsoft.com/en-us/library/aa983476.aspx">http://msdn.microsoft.com/en-us/library/aa983476.aspx</a></a>.</p>

<p>3) Clique com o botão direito na solução, depois em properties. Na aba Application, verifique se o Target Framework está selecionado para .NET Framework 3.5.</p>

<p>4) Adicione as referências para o projeto <em>System.Web.Mvc</em>, Syst<em>em.Web.Abstractions</em> e <em>System.Web.Routing</em>. Elas estão na aba .NET.</p>

<p>5) Nas suas referências selecione os assemblies que você acabou de adicionar, vá na janela propriedades e na propriedade CopyLocal selecione True.</p>

<p><img class="aligncenter" src="/images/2009/11/Screen-shot-2009-11-14-at-16.10.26.png" title="&lsquo;Marcando referências para CopyLocal = true&rsquo;" ></p>

<p>6) Se você ainda não tiver, crie um arquivo Global.asax</p>

<p>7) Altere seu arquivo Global.asax para que fique assim:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Global</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">HttpApplication</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">protected</span> <span class="k">void</span> <span class="n">Application_Start</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">RegisterRoutes</span><span class="p">(</span><span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterRoutes</span><span class="p">(</span><span class="n">RouteCollection</span> <span class="n">routes</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">routes</span><span class="p">.</span><span class="n">IgnoreRoute</span><span class="p">(</span><span class="s">&quot;{resource}.axd/{*pathInfo}&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">routes</span><span class="p">.</span><span class="n">MapRoute</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">,</span> <span class="s">&quot;{controller}/{action}/{id}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="k">new</span> <span class="p">{</span><span class="n">action</span> <span class="p">=</span> <span class="s">&quot;Index&quot;</span><span class="p">,</span> <span class="n">id</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Nesse momento, estamos apenas adicionando uma rota padrão. Veja que a rota padrão não tem um controller padrão, isso para que quando alguém acessar o seu site sem informar nada na url (ex: www.meusite.com.br), ele seja redirecionado para a página default, geralmente a página default.aspx.</p>

<p>8) Ative o UrlRoutingModule no seu web.config.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="ni">&amp;lt;</span>system.web&gt;
</span><span class='line'>  <span class="ni">&amp;hellip;</span>
</span><span class='line'>  <span class="nt">&lt;httpModules&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>add name=&quot;UrlRoutingModule&quot; type=&quot;System.Web.Routing.UrlRoutingModule, System.Web.Routing&quot;/<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>  <span class="nt">&lt;/httpModules&gt;</span>
</span><span class='line'>  <span class="ni">&amp;hellip;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/system.web&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>9) Na raiz do seu projeto adicione uma pasta Controllers e outra Views.</p>

<p>10) Para ativar os helpers do MVC, as tags &lt;%= Html.* %&gt;, é preciso adicionar uma tagno web.config.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;pages&gt;</span>
</span><span class='line'><span class="ni">&amp;hellip;</span><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>namespaces<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>add namespace=&quot;System.Web.Mvc&quot;/<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>add namespace=&quot;System.Web.Mvc.Html&quot;/<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>add namespace=&quot;System.Web.Routing&quot;/<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>add namespace=&quot;System.Linq&quot;/<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>add namespace=&quot;System.Collections.Generic&quot;/<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/namespaces<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span> <span class="ni">&amp;hellip;</span>
</span><span class='line'><span class="nt">&lt;/pages&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>11) Adicione as configurações abaixo na tag pages e na tag controls para que você consiga usar Views tipadas.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="ni">&amp;lt;</span>system.web&gt;
</span><span class='line'>..<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>pages
</span><span class='line'>    validateRequest=&quot;false&quot; pageParserFilterType=&quot;System.Web.Mvc.ViewTypeParserFilter,
</span><span class='line'>    System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;
</span><span class='line'>    pageBaseType=&quot;System.Web.Mvc.ViewPage, System.Web.Mvc, Version=1.0.0.0, Culture=neutral,
</span><span class='line'>    PublicKeyToken=31BF3856AD364E35&quot;
</span><span class='line'>    userControlBaseType=&quot;System.Web.Mvc.ViewUserControl, System.Web.Mvc, Version=1.0.0.0,
</span><span class='line'>    Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="ni">&amp;lt;</span>controls<span class="ni">&amp;gt;</span>
</span><span class='line'>    ...
</span><span class='line'>        <span class="ni">&amp;lt;</span>add assembly=&quot;System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;
</span><span class='line'>            namespace=&quot;System.Web.Mvc&quot; tagPrefix=&quot;mvc&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>/controls<span class="ni">&amp;gt;</span>
</span><span class='line'>....
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Pronto, se você adicionar um Controller HomeController na pasta Controllers com uma action Index, por exemplo, e for na pasta Views, criar uma pasta Home, um arquivo Index.aspx e no code behind da página trocar a classe base de System.Web.UI.Page para System.Web.Mvc.ViewPage, já deve funcionar.</p>

<p>Agora se você quiser que os wizards do Visual Studio para o MVC como o Add &ndash;&gt; Controller ou Add &ndash;&gt; View, é preciso fazer mais uma coisa.</p>

<p>1) Na janela Solution Explorer, clique com o botão direito em Unload Project.</p>

<p>2) Clique com o botão direito no projeto e em Edit Nome-do-Projeto.csproj</p>

<p>3) Dentro do XML que abriu procure a tag</p>

<p>e adicione o item abaixo na frente dos outros:</p>

<p>{603c0e0b-db56-11dc-be95-000d561079b0};</p>

<p>4) Salve o arquivo, clique com o botão direito no projeto e em Reload Project.</p>

<p>Se der um erro &ldquo;Unable to read the project file&rdquo;, clique em OK e depois faça o Reload Project novamente.</p>
]]></content>
  </entry>
  
</feed>
