
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Temple Coding</title>
  <meta name="author" content="Thiago Temple">

  
  <meta name="description" content="Eu já falei anteriormente do Selenium mas usando um outro enfoque, hoje eu queria falar sobre uma prática que adotamos na GoLive para testar os &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://vintem.github.io/templecoding/blog/page/9">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Temple Coding" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><h1><a href="/">Temple Coding</a></h1>

<h2>código, tecnologia e outras nerdices</h2>


</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:vintem.github.io/templecoding" />
    <input class="search" type="text" name="q" placeholder="Procurar"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arquivos</a></li>
  <li><a href="/blog/categories/videocast">Videocast</a></li>
  <li><a href="/sobre">Sobre</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/04/testes-integrados-com-o-selenium-ii/">Testes integrados com o Selenium II</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-04T00:00:00-05:00"  data-updated="true">04/01/2010</time>
        
         | <a href="/blog/2010/01/04/testes-integrados-com-o-selenium-ii/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="/blog/2009/11/08/testes-integrados-e-automaticos-com-selenium/">Eu já falei anteriormente do Selenium</a> mas usando um outro enfoque, hoje eu queria falar sobre uma prática que adotamos na <a href="http://www.golive.com.br" target="_blank">GoLive</a> para testar os aplicativos web.</p>

<p>Nada muito complicado, nem do outro mundo, mas ao invés de longos documentos com print screens de telas, ou formulários que são mal preenchidos, estamos gravando os testes de aplicações web com o Selenium. Quando um erro é encontrado, o bug é registrado no relatório de bugs e o arquivo do Selenium é anexado (na verdade hoje ele ainda é enviado por email).</p>

<p>Pra reproduzir o erro, basta abrir o arquivo no firefox e debugar :&ndash;).</p>

<p>Uma mudança simples no processo, mas que na minha opinião facilitou bastante a correção de erros.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/27/ha-um-ano-atras-como-voce-estava/">Há um ano atrás, como você estava?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-27T00:00:00-05:00"  data-updated="true">27/12/2009</time>
        
         | <a href="/blog/2009/12/27/ha-um-ano-atras-como-voce-estava/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tente lembrar o que você estava fazendo em dezembro de 2008. Agora veja o que você está fazendo hoje. Tem alguma diferença ou você está fazendo a mesma coisa? Melhor ainda, você olha para o que você estava fazendo há um ano e vê que poderia fazer aquilo melhor hoje?</p>

<p>Não é um caso de vida ou morte, ou uma obrigatoriedade fazer coisas diferentes, mas é bom, caso contrário, paramos no tempo. É extremamente importante ver que sabemos mais hoje do que há um ano atrás, que conseguimos ver que podemos fazer algo melhor hoje do que há um ano atrás.</p>

<p><img class="aligncenter" src="/images/2009/12/computer_evolution-300x121.jpg" title="Computer evolution" ></p>

<p>Agora pare e veja o que mudou em 1 ano, prá começar temos uma nova versão de Windows e Mac OS (honestamente não tenho acompanhado as notícias do linux), os frameworks mudam quase que mensalmente :&ndash;), além disso o Rails que está quase na versão 3 (prevista para o início  de 2010) está cada vez mais consolidado. O .Net 4  e o Visual Studio já estão em beta e serão lançados no início do ano que vem. O Asp.Net MVC foi lançado esse ano e tem sido muito usado, cada vez mais se fala e se usa o jQuery, isso só pra citar algumas coisas.</p>

<p>Fim de ano né, tempo de refletir, e por que não refletir sobre nossa vida profissional, onde crescemos e melhoramos e onde ficamos devendo? Eu posso fazer uma avaliação bem legal do que eu aprendi, posso dizer que nesse ano tive a oportunidade de aprender e evoluir muito, foi um ano que eu me dediquei a fazer mais testes unitários, pude trabalhar com java e colocar algo em produção com ele, aprendi um pouco de SAP/PI e pude comparar com o que eu já sabia de BizTalk, comecei meus estudos e estou aprendendo Ruby on Rails, entre outras coisas, enfim, o mais importante é que termino esse ano tendo a certeza que sei mais hoje do que há um ano atrás. E você? Espero que possa dizer o mesmo.</p>

<p>Bom ano novo a todos!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/21/porque-eu-acredito-no-desenvolvedor-poliglota/">Porque eu acredito no desenvolvedor poliglota</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-21T00:00:00-05:00"  data-updated="true">21/12/2009</time>
        
         | <a href="/blog/2009/12/21/porque-eu-acredito-no-desenvolvedor-poliglota/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Não é de hoje, sempre houve muita discussão sobre qual linguagem é melhor ou qual plataforma, ou qual é mais rápida e mais eficiente. Eu, que sempre fui um desenvolvedor que utiliza as tecnologias da Microsoft, sempre ouvi muita reclamação principalmente do pessoal que trabalha com Java e o contrário também é verdadeiro. Mas hoje a gente ouve também muitas reclamações/alegações das pessoas que trabalham com linguagens dinâmicas como Ruby ou Phyton.</p>

<p>Eu nunca participei dessas discussões fervorosas, porque eu nunca conheci muito bem o outro lado e eu acho que ninguém pode falar mal de algo que não conhece, é preciso conhecer pelo menos na teoria. Argumentar que uma empresa é demônio, ou uma arquitetura é lenta porque ela era em 1994, é algo inconsistente hoje, em meio a tanta informação que temos. E, no entanto, essa é uma das coisas que eu mais vejo, pessoas que conhecem apenas o seu umbigo achando que aquele é o melhor dos mundos.</p>

<p>Mas nesse ano de 2009 eu tive algumas oportunidades de estudar, aliás várias oportunidades. Foi um ano de grande aprendizado e vou falar mais sobre isso em um outro post, mas eu pude utilizar diferentes tecnologias e linguagens e muitas delas seriam conhecidas como “concorrentes”. Só para se ter uma idéia, esse ano eu usei C#, Java e Ruby, BizTalk e PI, SQL Server e Oracle, entre outras.</p>

<p>E vou te contar uma novidade que aposto que você nunca ouviu, “não existe bala de prata”!!! Sim, é verdade, você deve estar perplexo agora. Mas cada linguagem (e agora vou focar principalmente em linguagens) e suas respectivas plataformas, tem suas vantagens e desvantagens.</p>

<p><img class="aligncenter" src="/images/2009/12/especial2j.jpg" title="Torre de Babel" ></p>

<p>Não é meu objetivo enumerar vantagens e desvantagens aqui, mesmo porque eu ainda não tenho a prepotência de achar que eu conheço tanto dessas linguagens para fazer isso. Mas eu quero dizer que eu acredito hoje num desenvolvedor poliglota, porque eu acho que com o conhecimento de algumas linguagens e experiência é possível escolher a melhor ferramenta para o trabalho a ser desenvolvido. E não só isso, depois de anos usando C#, ao me deparar com uma linguagem dinâmica como o Ruby, pude rever o jeito que eu enxergo programação e uma outra coisa muito simples, pude entender melhor o Javascript, que, honestamente, eu nunca tinha enxergado como eu enxergo hoje (shame on me).</p>

<p>Eu acredito que para ser um bom desenvolvedor é preciso ter uma mente aberta a novas idéias. No nosso ramo as coisas evoluem muito rapidamente, uma coisa que era ótima no ano passado, ano que vem é possível que existam outras dezenas melhores que ela. Frameworks surgem quase que diariamente para as diversas linguagens que existem. É óbvio que não dá para se manter atualizado em tudo e em todas as linguagens, mas escolha algumas que você vai acompanhar mais de perto e leia sobre outras que estão surgindo para ver se elas não devem substituir/acrescentar às que você usa ou apenas se elas não mudam um pouco mais o seu jeito de pensar. Afinal de contas os problemas que temos que resolver não são os mesmos todos os dias.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/14/o-firebug-e-seu-amigo/">O Firebug é seu amigo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-14T00:00:00-05:00"  data-updated="true">14/12/2009</time>
        
         | <a href="/blog/2009/12/14/o-firebug-e-seu-amigo/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Se você, assim como eu, redescobriu o javascript ultimamente (por mim principalmente por causa do jQuery), então você vai gostar de usar (se ainda não usa) o <a href="https://addons.mozilla.org/en-US/firefox/addon/1843" target="_blank">Firebug</a>.<br /><br />O Firebug é um add-on para o Firefox que permite debugar o javascript, analisar o que foi enviado em Requests e Responses de chamada ajax.<br /><br />É só instalar o add-on e abrir o console dentro do Firefox e pronto. Na aba Script é onde coloca-se os breakpoints e faz a execução do script passo a passo, inclusive com a janela Watch para ver o valor das variáveis.<br /><br />Na aba console é possível executar comandos javascript em tempo de execução. Uma mão na roda pra quem usa o javascript. E ele ainda exibe a árvore DOM, o HTML gerado, o CSS, enfim, uma série de funcionalidades que fazem dele uma ferramenta obrigatória.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/09/dependency-injection-com-structuremap-e-asp-net-mvc/">Dependency Injection com StructureMap e Asp.Net MVC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-09T00:00:00-05:00"  data-updated="true">09/12/2009</time>
        
         | <a href="/blog/2009/12/09/dependency-injection-com-structuremap-e-asp-net-mvc/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ok, então você começou a usar o Dependency Injection e viu que dava <a target="_self" href="/blog/2009/11/22/asp-net-mvc-e-o-padrao-dependency-injection/">muito trabalho</a>. A boa notícia é que existem vários frameworks por aí que ajudam a diminuir o trabalho e ainda a ter um código muito mais limpo.<br /></p>

<br />


<p>Particularmente, eu gosto muito do <a target="_blank" href="http://structuremap.sourceforge.net/Default.htm">StructureMap</a>, principalmente porque ele nos permite utilizar o &ldquo;Convention over Configuration&rdquo;. Vamos ver jajá como isso funciona.<br /></p>

<br />


<p>Bom, dando sequência no <a href="/blog/2009/11/22/asp-net-mvc-e-o-padrao-dependency-injection/">post anterior</a>, vamos modificar aquele código para utilizar o StructureMap. A primeira coisa a fazer obviamente é baixar o framework e adicionar uma referência para o assembly StructureMap.dll.<br /></p>

<br />


<p>O próximo passo é configurar o StructureMap, para isso vamos criar uma classe:<br /></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">StructureMapConfiguration</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">ObjectFactory</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">InitializeStructureMap</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">InitializeStructureMap</span><span class="p">(</span><span class="n">IInitializationExpression</span> <span class="n">x</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">x</span><span class="p">.</span><span class="n">Scan</span><span class="p">(</span><span class="n">y</span> <span class="p">=&gt;</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">y</span><span class="p">.</span><span class="n">Assembly</span><span class="p">(</span><span class="s">&quot;MvcApplication1&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="n">y</span><span class="p">.</span><span class="n">With</span><span class="p">&lt;</span><span class="n">defaultconventionscanner</span><span class="p">&gt;();</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<br />


<p>O que fazemos nesse código e dizer para o ScrutureMap buscar no Assembly MvcApplication1 usando a convenção padrão. E o que é a convenção padrão? Geralmente quando criamos uma interface, como no nosso caso criamos a interface IClienteService criamos uma classe com a implementação padrão da interface chamada ClienteService. Essa é a convenção padrão, dessa forma, toda vez que precisarmos de um objeto que implemente a interface IClienteService o StructureMap buscará nos assemblies informados para ele, a classe de mesmo nome só que sem o I. Prático não? Nada de configurar XMLs e afins (embora o StructureMap permita isso).<br /></p>

<br />


<p>Outra coisa que precisamos fazer é criar uma classe que será responsável pela criação dos nosso controllers. Isso é necessário porque por padrão o Asp.Net MVC cria os controllers apenas com o construtor padrão, sem parâmetros. Nossa classe fica assim:<br /></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">StructureMapControllerFactory</span> <span class="p">:</span> <span class="n">DefaultControllerFactory</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="k">override</span> <span class="n">IController</span> <span class="nf">GetControllerInstance</span><span class="p">(</span><span class="n">Type</span> <span class="n">controllerType</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">controllerType</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="k">try</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">ObjectFactory</span><span class="p">.</span><span class="n">GetInstance</span><span class="p">(</span><span class="n">controllerType</span><span class="p">)</span> <span class="k">as</span> <span class="n">Controller</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">catch</span> <span class="p">(</span><span class="n">StructureMapException</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="n">Debug</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ObjectFactory</span><span class="p">.</span><span class="n">WhatDoIHave</span><span class="p">());</span>
</span><span class='line'>            <span class="k">throw</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<br />


<p>Pronto, agora vamos alterar a inicialização da aplicação no Global.asax, que deve ficar assim:<br /></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">RegisterRoutes</span><span class="p">(</span><span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">);</span>
</span><span class='line'>    <span class="n">StructureMapConfiguration</span><span class="p">.</span><span class="n">Configure</span><span class="p">();</span>
</span><span class='line'>    <span class="n">ControllerBuilder</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">SetControllerFactory</span><span class="p">(</span><span class="k">new</span>
</span><span class='line'>        <span class="n">StructureMapControllerFactory</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<br />


<p>Uma última coisa, no nosso controller ClienteController tínhamos dois construtores, agora vamos deixar apenas um com o parâmetro necessário para funcionar:<br /></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">IClienteService</span> <span class="n">_service</span><span class="p">;</span>
</span><span class='line'><span class="k">public</span> <span class="nf">ClienteController</span><span class="p">(</span><span class="n">IClienteService</span> <span class="n">service</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">_service</span> <span class="p">=</span> <span class="n">service</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<br />


<p>Pronto, isso é tudo o que é necessário. Mas se você quiser utilizar um XML para configurar suas classes, é possível. Dentro da classe de configuração, logo abaixo do método Scan, adicione:<br /></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">x</span><span class="p">.</span><span class="n">AddConfigurationFromXmlFile</span><span class="p">(</span><span class="s">&quot;structuremap.config.xml&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<br />


<p>Isso fará que com que o StructureMap procure na raiz do site por um arquivo chamado structuremap.config.xml. Segue um exemplo de como deve ser esse arquivo:<br /></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;structuremap</span> <span class="na">mementostyle=</span><span class="s">&quot;Attribute&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;defaultinstance&gt;</span>
</span><span class='line'>    PluginType=&quot;MinhaLibrary.Business.IClasseNegocio, MinhaLibrary.Business&quot;
</span><span class='line'>    PluggedType=&quot;MinhaLibrary.Business.ImplementacaoClasseNegocio, MinhaLibrary.Business&quot;
</span><span class='line'>    Scope=&quot;Singleton&quot; /&gt;
</span><span class='line'>  <span class="nt">&lt;/defaultinstance&gt;</span>
</span><span class='line'><span class="nt">&lt;/structuremap&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<br />


<p>É isso! E viva o Convention over Configuration!!!!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/22/asp-net-mvc-e-o-padrao-dependency-injection/">Asp.Net MVC e o padrão Dependency Injection</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-22T00:00:00-05:00"  data-updated="true">22/11/2009</time>
        
         | <a href="/blog/2009/11/22/asp-net-mvc-e-o-padrao-dependency-injection/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>O padrão Dependency Injection (DI) é  utilizado para diminuir o acoplamento entre as partes de um sistema.</p>

<p>Vou demonstrar em duas partes como fazer Dependency Injection, na primeira parte vou fazer a injeção de forma manual e depois vou utilizar o framework Structuremap para isso.</p>

<p>Existem algumas razões para se fazer isso, mas na minha opinião as principais são: facilitar a criação de testes unitários e a possibilidade de se estender uma aplicação sem comprometer as partes que dependem do funcionamento daquela aplicação.</p>

<p>Imagine o seguinte cenário:</p>

<p><img class="aligncenter" src="/images/2009/11/Cenario.jpg" title="'Cenário de Dependência'" ></p>

<p>No caso acima, temos uma classe ClienteController (já pensando no MVC), que usa/depende uma classe ClienteService, que é a classe responsável por todas as regras de negócio relativas a Cliente mas que usa/depende da classe ClienteRepository, que é a classe responsável por todas as atividades no banco de dados relacionadas a Cliente.</p>

<p>Uma implementação das classes ClienteController e ClienteService poderia ser feita assim:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClienteController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Novo</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">cliente</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ClienteService</span><span class="p">();</span>
</span><span class='line'>        <span class="n">service</span><span class="p">.</span><span class="n">Salvar</span><span class="p">(</span><span class="n">cliente</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClienteService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Salvar</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">c</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">ValidarCliente</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">rep</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ClienteRepository</span><span class="p">();</span>
</span><span class='line'>            <span class="n">rep</span><span class="p">.</span><span class="n">Salvar</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">ValidarCliente</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">cliente</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Veja na linha 5 que a classe ClienteController faz uma referência direta à classe ClienteService e na linha 17 a classe ClienteService faz uma referência direta à classe ClienteRepository. Isso não seria um problema se a) você não estiver considerando fazer testes unitários e b) se o seu sistema for um sistema pequeno com poucas classes e que não vá lhe gerar muitos problemas de manutenção.</p>

<p>No caso do teste unitário isso é um problema porque assim que for criado um teste para o método Salvar na classe ClienteController esse teste irá testar toda a sequência de atividades, inclusive as classes de Service e Repository.</p>

<p>Outro problema é o seguinte, imagine que esse é um sistema que você distribui para os seus clientes e que você tem uma outra classe ContasPagarService, a regra de negócio de contas a pagar varia de acordo com cada cliente que você tem. Se o código estivesse com o nível de dependência acima, talvez a única forma (ou a mais comum) de se resolver essa diferença seria implementando uma série de ifs dentro do código da classe de Service.</p>

<p>Como resolver esse problema então? 1o temos que começar quebrando as dependências criando interfaces.  Assim temos:</p>

<figure class='code'><figcaption><span>IClienteService.cs </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IClienteService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">void</span> <span class="nf">Salvar</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Depois disso, precisamos alterar as nossas classes para implementar as interfaces:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClienteRepository</span> <span class="p">:</span> <span class="n">IClienteRepository</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClienteService</span> <span class="p">:</span> <span class="n">IClienteService</span>
</span></code></pre></td></tr></table></div></figure>


<p>Agora já estamos prontos pra fazer um pouco de Dependency Injection.</p>

<p>Vamos começar reconhecendo as dependências em nossas classes, sabemos que a classe Controller depende da classe Service que por sua vez depende da classe Repository. Vamos trocar essas dependências para as interfaces que criamos e teremos a classe ClienteController assim:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClienteController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">IClienteService</span> <span class="n">_service</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="nf">ClienteController</span><span class="p">(</span><span class="n">IClienteService</span> <span class="n">service</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_service</span> <span class="p">=</span> <span class="n">service</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Novo</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">cliente</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_service</span><span class="p">.</span><span class="n">Salvar</span><span class="p">(</span><span class="n">cliente</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Veja que agora a classe ClienteController está esperando qualquer objeto que implemente a interface IClienteService e não temos mais uma dependência direta para a classe ClienteService.</p>

<p>Agora veja como ficou a classe ClienteService:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClienteService</span> <span class="p">:</span> <span class="n">IClienteService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">IClienteRepository</span> <span class="n">_repository</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span>  <span class="nf">ClienteService</span><span class="p">(</span><span class="n">IClienteRepository</span> <span class="n">repository</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_repository</span> <span class="p">=</span> <span class="n">repository</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Salvar</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">c</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">ValidarCliente</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">_repository</span><span class="p">.</span><span class="n">Salvar</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">ValidarCliente</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">cliente</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A classe ClienteService ficou muito parecida com a classe ClienteController. Agora ela espera um objeto que implemente a interface IClienteRepository no construtor e depois usa esse objeto nas chamadas do repository.</p>

<p>Agora só falta ligar os pontos. Como dizer para as classes que ClienteController e ClienteService qual objeto elas realmente vão usar.</p>

<p>Para isso vamos utilizar um outro padrão chamado Abstract Factory para centralizar todas as nossas dependências em uma única classe. A nossa classe de abstract factory ficou assim:</p>

<figure class='code'><figcaption><span>MeuProjetoFactory.cs </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">MeuProjetoFactory</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="n">IClienteService</span> <span class="nf">CriaClienteService</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span>  <span class="k">new</span> <span class="nf">ClienteService</span><span class="p">(</span><span class="n">CriaClienteRepository</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span>  <span class="k">static</span> <span class="n">IClienteRepository</span> <span class="nf">CriaClienteRepository</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span>  <span class="k">new</span> <span class="nf">ClienteRepository</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Como vemos, nessa classe sabemos como criar um objeto de cada interface que precisamos. Qual a vantagem disso? Todas as dependências estão centralizadas em único local, muito mais fácil para dar manutenção, não é?</p>

<p>Agora na nossa classe de Controller, precisamos fazer mais uma modificação:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClienteController</span> <span class="p">:</span> <span class="n">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">IClienteService</span> <span class="n">_service</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">ClienteController</span><span class="p">():</span> <span class="k">this</span><span class="p">(</span><span class="n">MeuProjetoFactory</span><span class="p">.</span><span class="n">CriaClienteService</span><span class="p">())</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">ClienteController</span><span class="p">(</span><span class="n">IClienteService</span> <span class="n">service</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_service</span> <span class="p">=</span> <span class="n">service</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Novo</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">cliente</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_service</span><span class="p">.</span><span class="n">Salvar</span><span class="p">(</span><span class="n">cliente</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pronto, agora toda vez que uma classe ClienteController for criada, se no momento da criação não for informado um IClienteService e for utilizado o construtor padrão, automaticamente iremos buscar da nossa classe de factory.</p>

<p>Isso deve ser feito dessa forma porque o Asp.Net MVC por padrão não consegue criar controllers sem ser pelo construtor padrão.</p>

<p>Pronto, agora já temos um sistema com as nossas camadas bem separadas e utilizando o padrão Dependency Injection.</p>

<p>Agora se quisermos testar a nossa classe ClienteController é só passar uma classe de mock que implemente a interface IClienteService para o construtor.</p>

<p>E no caso que falei sobre as regras de negócio diferentes no contas a pagar? Bom, uma das soluções para isso nesse caso seria ter várias classes que implementassem IContasPagarService por exemplo, ContasPagarCliente1Service, ContasPagarClienteXptoService e assim por diante. Então, dentro do abstract factory, poderíamos ter um método assim:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">IContasPagarService</span> <span class="nf">CriaContasPagarService</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">&quot;Cliente&quot;</span><span class="p">])</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>       <span class="k">case</span> <span class="s">&quot;Cliente1&quot;</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="nf">ContasPagarCliente1Service</span><span class="p">();</span>
</span><span class='line'>       <span class="k">case</span> <span class="s">&quot;ClienteXpto&quot;</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="nf">ContasPagarClienteXptoService</span><span class="p">();</span>
</span><span class='line'>       <span class="k">default</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="nf">ContasPagarService</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>De novo, estamos centralizando tudo na classe de abstract factory e utilizando o web.config para configurarmos qual classe de negócio utilizaremos. Um código bem mais simples e limpo. E ainda, a cada vez que tivermos que mudar uma regra de negócio de um cliente específico, não precisamos nos preocupar se afetamos ou não a regra de negócio de outro.</p>

<p>No próximo post eu vou falar sobre como fazer Dependency Injection de uma forma ainda mais fácil que essa. Espero que nesse ponto pelo menos a teoria esteja clara.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/14/utilizando-o-asp-net-mvc-junto-com-asp-net-webforms/">Utilizando o Asp.Net MVC junto com Asp.Net WebForms</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-14T00:00:00-05:00"  data-updated="true">14/11/2009</time>
        
         | <a href="/blog/2009/11/14/utilizando-o-asp-net-mvc-junto-com-asp-net-webforms/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Para aqueles que como eu, gostaram muito da implementação do MVC para o Asp.Net (eu relutei no início, mas tive que ceder, ficou muito bom) e gostariam de começar a usá-lo já, mas não tem nenhum projeto novo pra implementá-lo, existe uma forma de utilizar o Asp.Net MVC junto com os costumeiros Web Forms.</p>

<p>A 1a coisa que você precisa verificar, obviamente, é se o servidor onde roda o seu site suporta o .Net Framework 3.5, já que o Asp.Net MVC precisa dessa versão.</p>

<p>1) Se o projeto foi feito no Visual Studio 2005 ou 2003, abra ele no Visual Studio 2008 e siga o wizard pra converter o projeto para o Visual Studio 2008.</p>

<p>2) Se o seu projeto for uma web application (que tem a pasta bin) pode pular essa etapa, se for um web site é preciso convertê-lo para um web application. Veja como aqui <a href="http://msdn.microsoft.com/en-us/library/aa983476.aspx" target="_blank"><a href="http://msdn.microsoft.com/en-us/library/aa983476.aspx">http://msdn.microsoft.com/en-us/library/aa983476.aspx</a></a>.</p>

<p>3) Clique com o botão direito na solução, depois em properties. Na aba Application, verifique se o Target Framework está selecionado para .NET Framework 3.5.</p>

<p>4) Adicione as referências para o projeto <em>System.Web.Mvc</em>, Syst<em>em.Web.Abstractions</em> e <em>System.Web.Routing</em>. Elas estão na aba .NET.</p>

<p>5) Nas suas referências selecione os assemblies que você acabou de adicionar, vá na janela propriedades e na propriedade CopyLocal selecione True.</p>

<p><img class="aligncenter" src="/images/2009/11/Screen-shot-2009-11-14-at-16.10.26.png" title="'Marcando referências para CopyLocal = true'" ></p>

<p>6) Se você ainda não tiver, crie um arquivo Global.asax</p>

<p>7) Altere seu arquivo Global.asax para que fique assim:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Global</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">HttpApplication</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">RegisterRoutes</span><span class="p">(</span><span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterRoutes</span><span class="p">(</span><span class="n">RouteCollection</span> <span class="n">routes</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">routes</span><span class="p">.</span><span class="n">IgnoreRoute</span><span class="p">(</span><span class="s">&quot;{resource}.axd/{*pathInfo}&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">routes</span><span class="p">.</span><span class="n">MapRoute</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">,</span> <span class="s">&quot;{controller}/{action}/{id}&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="k">new</span> <span class="p">{</span><span class="n">action</span> <span class="p">=</span> <span class="s">&quot;Index&quot;</span><span class="p">,</span> <span class="n">id</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nesse momento, estamos apenas adicionando uma rota padrão. Veja que a rota padrão não tem um controller padrão, isso para que quando alguém acessar o seu site sem informar nada na url (ex: www.meusite.com.br), ele seja redirecionado para a página default, geralmente a página default.aspx.</p>

<p>8) Ative o UrlRoutingModule no seu web.config.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;system.web&gt;</span>
</span><span class='line'>  ...
</span><span class='line'>  <span class="nt">&lt;httpModules&gt;</span>
</span><span class='line'>    <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;UrlRoutingModule&quot;</span> <span class="na">type=</span><span class="s">&quot;System.Web.Routing.UrlRoutingModule, System.Web.Routing&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/httpModules&gt;</span>
</span><span class='line'>  ...
</span><span class='line'><span class="nt">&lt;/system.web&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>9) Na raiz do seu projeto adicione uma pasta Controllers e outra Views.</p>

<p>10) Para ativar os helpers do MVC, as tags &lt;%= Html.* %&gt;, é preciso adicionar uma tagno web.config.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;pages&gt;</span>
</span><span class='line'>...
</span><span class='line'>    <span class="nt">&lt;namespaces&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">namespace=</span><span class="s">&quot;System.Web.Mvc&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">namespace=</span><span class="s">&quot;System.Web.Mvc.Html&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">namespace=</span><span class="s">&quot;System.Web.Routing&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">namespace=</span><span class="s">&quot;System.Linq&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;add</span> <span class="na">namespace=</span><span class="s">&quot;System.Collections.Generic&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/namespaces&gt;</span>
</span><span class='line'> ...
</span><span class='line'><span class="nt">&lt;/pages&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>11) Adicione as configurações abaixo na tag pages e na tag controls para que você consiga usar Views tipadas.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;system.web&gt;</span>
</span><span class='line'>..
</span><span class='line'>    <span class="nt">&lt;pages</span>
</span><span class='line'>        <span class="na">validateRequest=</span><span class="s">&quot;false&quot;</span> <span class="na">pageParserFilterType=</span><span class="s">&quot;System.Web.Mvc.ViewTypeParserFilter,</span>
</span><span class='line'><span class="s">        System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;</span>
</span><span class='line'>        <span class="na">pageBaseType=</span><span class="s">&quot;System.Web.Mvc.ViewPage, System.Web.Mvc, Version=1.0.0.0, Culture=neutral,</span>
</span><span class='line'><span class="s">        PublicKeyToken=31BF3856AD364E35&quot;</span>
</span><span class='line'>        <span class="na">userControlBaseType=</span><span class="s">&quot;System.Web.Mvc.ViewUserControl, System.Web.Mvc, Version=1.0.0.0,</span>
</span><span class='line'><span class="s">        Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;controls&gt;</span>
</span><span class='line'>        ...
</span><span class='line'>            <span class="nt">&lt;add</span> <span class="na">assembly=</span><span class="s">&quot;System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;</span>
</span><span class='line'>                <span class="na">namespace=</span><span class="s">&quot;System.Web.Mvc&quot;</span> <span class="na">tagPrefix=</span><span class="s">&quot;mvc&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/controls&gt;</span>
</span><span class='line'>    ....
</span></code></pre></td></tr></table></div></figure>


<p>Pronto, se você adicionar um Controller HomeController na pasta Controllers com uma action Index, por exemplo, e for na pasta Views, criar uma pasta Home, um arquivo Index.aspx e no code behind da página trocar a classe base de System.Web.UI.Page para System.Web.Mvc.ViewPage, já deve funcionar.</p>

<p>Agora se você quiser que os wizards do Visual Studio para o MVC como o Add &ndash;&gt; Controller ou Add &ndash;&gt; View, é preciso fazer mais uma coisa.</p>

<p>1) Na janela Solution Explorer, clique com o botão direito em Unload Project.</p>

<p>2) Clique com o botão direito no projeto e em Edit Nome-do-Projeto.csproj</p>

<p>3) Dentro do XML que abriu procure a tag</p>

<p>e adicione o item abaixo na frente dos outros:</p>

<p>{603c0e0b-db56-11dc-be95-000d561079b0};</p>

<p>4) Salve o arquivo, clique com o botão direito no projeto e em Reload Project.</p>

<p>Se der um erro &ldquo;Unable to read the project file&rdquo;, clique em OK e depois faça o Reload Project novamente.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/08/testes-integrados-e-automaticos-com-selenium/">Testes integrados e automáticos com Selenium</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-08T00:00:00-05:00"  data-updated="true">08/11/2009</time>
        
         | <a href="/blog/2009/11/08/testes-integrados-e-automaticos-com-selenium/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Existem muitas maneiras de testarmos nossos sistemas, uma delas é o teste integrado, que nada mais é do que testar o sistema passando por todos os módulos do mesmo. Imaginando um sistema que acessa um banco de dados ou um web service por exemplo, o teste deve cobrir a chamada pela interface de usuário, passando pelas camadas de negócio até chegar no banco ou no web service.</p>

<p>Existem várias maneiras de se realizar testes integrados, a mais comum que eu tenho visto é o teste manual, onde um usuário faz o teste de ponta a ponta. Mas e se houver uma mudança no sistema? Deve-se fazer todos os testes manualmente de novo? Isso com certeza tomaria muito tempo e trabalho. É para esse tipo de caso que existem ferramentas como o <a href="http://seleniumhq.org/" target="_blank">Selenium</a>.</p>

<p>O Selenium é uma ferramenta bem simples e muito fácil de usar. Primeiro, no site do Selenium é possível baixar a IDE e ela roda como um plugin do firefox. Eu não vou falar muito sobre como gravar o teste com o Selenium, porque ele é muito simples e tem um ótimo vídeo no site explicando como gravar teste. Mas neste momento, basta saber que ao abrir a IDE do Selenium, ela começa a gravar todas as ações realizadas no browser, que podem ser salvas e executadas a qualquer momento.</p>

<p>A parte que mais me interessou, é que ao final da gravação do teste é possível exportar esse teste para ser executado dentro de ferramentas de teste unitário, como o nUnit ou o jUnit.</p>

<p><img class="aligncenter" src="/images/2009/11/Screen-shot-2009-11-08-at-20.18.26.png" title="'Exportando o teste para o nunit'" ></p>

<p>Como é  possível ver, ele gera o código (nesse caso em C#) para rodar dentro do nUnit.</p>

<p>Para rodar esse teste dentro do nUnit, primeiro é preciso baixar o Selenium RC (Remote Control), no próprio site do Selenium. Ao descompactá-lo, você vai ver que ele tem diversas pastas com clients e um server. No caso do .Net, basta adicionar os assemblies como referência ao projeto de teste, criar uma nova classe para o teste, copiar e colar o código.</p>

<p>Antes de testar é preciso iniciar o server do Remote Control. Junto com as pastas de client existe uma de server. Para iniciar o servidor basta ir no prompt e executar <em>java -jar selenium-server.jar</em>. Se possível, faça isso em uma máquina de servidor para que todos possam executar os testes.</p>

<p>Com o servidor rodando, nós voltamos para o código e ajustamos apenas o método SetupTest com as configurações do servidor e do endereço do site que iremos testar:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[SetUp]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">SetupTest</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">selenium</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DefaultSelenium</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="m">4444</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;*firefox&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;http://localhost:1220/&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">selenium</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">verificationErrors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>No caso acima, eu iniciei o servidor na minha máquina, localhost, na porta 4444 que é a padrão, o browser que está usando para testes, no meu caso o firefox (no site tem uma lista dos browsers suportados) e depois o endereço do servidor onde está o site que eu vou testar.</p>

<p>Pronto, isso é tudo o que é necessário para rodar o teste no nUnit. Depois disso, basta o servidor do Remote Control estar ligado e você pode rodar os testes quando e quantas vezes quiser.</p>

<p><strong>Refatorando seu código</strong></p>

<p>Pensando em sistemas que não tem testes unitários ou tem um código muito acoplado e de difícil manutenção (ou qualquer outra boa razão para refatorar o código), essa é uma ótima solução para refatorar o código com mais segurança.</p>

<p>A idéia é gerar diversos testes usando o Selenium e gravar esses testes para serem rodados em um framework de testes, como o nUnit, fazer as mudanças no código que achamos necessárias, por exemplo desacoplar o código para permitir que testes unitários sejam criados. Após as modificações rodamos os testes feitos com o Selenium para ver se nada parou de funcionar.</p>

<p>Você pode se perguntar então, por que fazer testes unitários se posso testar todo o sistema só gravando minhas ações no browser? A principal razão é que testes integrados, por passarem por todo o sistema, tendem a ser mais lentos para executar do que testes unitários que devem testar pequenas unidades de código. Se esses testes integrados envolverem chamadas a sistemas de terceiros como Web Services, chamadas via socket, chamadas a ERPs, etc., podem ficar ainda mais lentos. Imagine se você fizer testes para o sistema todo. A tendência é que você não fique esperando que o teste rode, por exemplo, em 10 minutos para saber se cada modificação feita funcionou. Por isso testes unitários devem sempre ser feitos.</p>

<p><strong>Agende seus testes integrados para rodar periodicamente</strong></p>

<p>Você pode usar os testes integrados para auxiliar na refatoração de código, principalmente se você não tem testes unitários (e então começar a criá-los). Mas outra questão importante é testar se o sistema/funcionalidade estão funcionando de acordo com o esperado como um todo, ou mais obviamente, integralmente. Mas se o teste demora muito para rodar e você não quer ficar esperando, você sempre pode agendar para que o teste rode de madrugada, por exemplo. Para isso existem ferramentas como o <a href="http://cruisecontrol.sourceforge.net/" target="_blank">CruiseControl</a> e o <a href="http://wiki.hudson-ci.org/display/HUDSON/Meet+Hudson" target="_blank">Hudson</a>, só para citar duas. Essas são ferramentas de Integração Contínua (vou falar sobre isso num outro post) que além de outras coisas, podem rodar os testes integrados em um horário determinado.</p>

<p>Como eu disse anteriormente, existem muitas formas e ferramentas para realizar testes integrados, essa é apenas uma delas, que achei muito prática e fácil, além do que o Selenium é uma ferramenta gratuita.</p>

<p>Site do Selenium &ndash; <a href="http://seleniumhq.org/" target="_self"><a href="http://seleniumhq.org/">http://seleniumhq.org/</a></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/01/existe-vida-alem-do-debug/">Existe vida além do debug</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-01T00:00:00-04:00"  data-updated="true">01/11/2009</time>
        
         | <a href="/blog/2009/11/01/existe-vida-alem-do-debug/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Fico impressionado a cada vez que resolvo falar com algum desenvolvedor sobre testes unitários. Na maioria das vezes em que faço isso a resposta que ouço é que eles não os fazem, não sabem como, ou em muitos casos acham que fazer testes unitários vai simplesmente aumentar o trabalho e o tempo de desenvolvimento, coisas que eles não podem alegar dentro de cronogramas apertados.</p>

<p>Ultimamente, tenho tomado como regra sempre fazer testes unitários e em alguns projetos já tenho até exercitado práticas como Test Driven Development (TDD) e Behavior Driven Development (BDD) &ndash; embora essas práticas não sejam obrigatórias para se ter testes unitários e no caso do TDD, este é mais focado em design, os testes são apenas uma consequência.</p>

<p>De qualquer forma, a prática dos testes unitários tem me trazido vários benefícios e comparar com projetos onde não existem os testes me ajuda a perceber esses benefícios e eu gostaria de compartilhá-los aqui.</p>

<p>Antes de falar dos benefícios gostaria apenas de citar que sim, fazer testes unitários vai tomar mais tempo da codificação da sua funcionalidade, alguns estudos indicam que esse tempo pode até dobrar. Mas como vamos ver mais adiante, esse tempo é depois recuperado em outras atividades.</p>

<p>1) Testes unitários são mais rápidos de serem executados</p>

<p style="padding-left: 30px;">Considerando que você está desenvolvendo algo com uma interface gráfica e na maioria das vezes estamos, se você é um desenvolvedor que se preocupa o mínimo com o código que produz, toda vez que você vai testar o que fez, você tem que entrar no seu ambiente gráfico (seja ele web ou desktop), navegar nas opções até chegar no ponto onde deseja realmente testar. Imagine se para corrigir um defeito ou implementar uma nova funcionalidade você tiver que fazer isso várias vezes. Esse tempo nunca é contado no seu desenvolvimento e muitas vezes não aparece em estatísticas principalmente se for uma correção de um bug.</p>


<p style="padding-left: 30px;">No caso dos testes unitários, utilizando a variedade de ferramentas que temos, escrevemos o teste uma vez apenas e podemos executá-los com a dificuldade de apenas um clique!</p>


<p>2) Testes unitários ajudam a documentar o seu sistema</p>

<p style="padding-left: 30px;">A maioria dos desenvolvedores não gosta de fazer documentos e eu me incluo nesse grupo. Agora se você encontrar um método que diz:</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Test]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">ListaTarefas_recebeIdProjeto1_DeveRetornarTarefasDoProjeto</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//validação</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ou assim:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;deve ter um cliente válido associado&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1">#validação</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p style="padding-left: 30px;">Na hora já sabemos qual a característica do código sob teste. Ou seja, um teste unitário <strong>(bem escrito)</strong> nos ajuda a entender o que o código faz ou deveria fazer, mais uma vez poupando tempo de leitura de código para entender ou lembrar o que ele faz. Porque eu não lembro com precisão o que fiz no mês passado, o que dirá de código que escrevi seis meses atrás.</p>


<p style="padding-left: 30px;">Pra ficar claro, há alguns dias atrás fomos testar uma funcionalidade de um sistema que não tem testes unitários e depois de algumas horas de debug achamos um if que deveria retornar dados de uma tabela em um caso e de outra tabela no else. E a pergunta surgiu &#8220;por que esse if está ai?&#8221;. Ninguém sabia responder de imediato porque aquilo foi feito há muito tempo, e que poderia ser facilmente respondido se tivesse um teste unitário com um nome claro, bastava comentar o código, esperar algum teste falhar e ver o porquê daquele if. Muito mais simples e rápido do que ter que mais uma vez gastar tempo em debug que ninguém soma no tempo total do projeto.</p>


<p>3) Testes unitários podem ser executados por qualquer desenvolvedor</p>

<p style="padding-left: 30px;">Quantos vezes não temos que alterar código que não fizemos ou que fizemos há muito tempo e que não nos lembramos mais dele direito? Nessas vezes eu sempre fico com aquela sensação de &#8220;será que eu realmente podia alterar isso&#8221;?</p>


<p style="padding-left: 30px;">Se o código tiver testes unitários e alterarmos algo que não devia, um teste irá falhar e se ele tiver um nome apropriado como vimos acima, será muito fácil saber o que foi feito de errado, trazendo confiança para alteração, mais tempo economizado, já que não vamos ter que debugar, analisar variáveis, ou realizar execuções linha a linha até descobrirmos o que parou. Isso, obviamente, se descobrirmos, porque muitas vezes é o usuário quem descobre, naquela situação de &#8220;você corrigiu uma coisa e quebrou outra&#8221;.</p>


<p>4) Testes unitários nos ajudam a melhorar o design do software</p>

<p style="padding-left: 30px;">Esse argumento é válido principalmente para as linguagens estaticamente tipadas como java e C#, mas não somente para elas.</p>


<p style="padding-left: 30px;">Um dos princípios do teste unitário é que ele deve testar uma unidade de código. Se um teste unitário é escrito de forma que ele começa testando sua camada de interface com o usuário, passa pelo camada de negócios, camada de dados e vai até o banco de dados (assumindo que o software seja divido em camadas), ele não é mais um teste unitário e sim um teste de integração - não há nada de errado com testes de integração, eles só servem para um propósito diferente. Bom, partindo desse princípio, quando escrevemos testes unitários estamos isolando as camadas do nosso sistema e se fizermos isso seguindo as orientações do <a href="http://pt.wikipedia.org/wiki/Gang_of_Four" target="_self">GOF</a> estaremos isolando as camadas, desenvolvendo orientado à interface, o que além do isolamento em si trás mais um benefício. Imagine o seguinte cenário:</p>


<p style="padding-left: 30px;"><span style="color: #3366ff;"><span style="color: #000000;">Você desenvolve um um software/produto que pode ser utilizado por vários clientes e na maioria dos casos esse produto deve se comportar de forma igual em todos os clientes, mas em um cliente específico uma das partes do sistema pede um comportamento diferente, o que você faz: (a) faz um if dentro daquela funcionalidade, (b) faz um build específico para aquele cliente ou (c) faz uma nova classe que implementa aquela interface especificamente para aquele cliente, não muda o código já existente e ainda mantém um único build?</span></span></p>


<p style="padding-left: 30px;"><span style="color: #3366ff;"><span style="color: #000000;">É claro pra mim que e a terceira opção é a melhor, e isso pode ser discutido em um outro post. Então voltemos ao teste unitário, e o benefício do desenvolvimento separado em camadas :-). Se o sistema tiver testes unitários e mais uma vez, testes unitários bem feitos, seu sistema consequentemente será mais isolado e terá uma manutenção muito mais fácil.</span></span></p>


<p><span style="color: #3366ff;"><span style="color: #000000;">5) Testes unitários auxiliam na produção de código com menos defeito</span></span></p>

<p style="padding-left: 30px;"><span style="color: #3366ff;"><span style="color: #000000;">Parece óbvia a afirmação, mas muitas pessoas só percebem a diferença quando começam a fazer os testes unitários. </span></span></p>


<p style="padding-left: 30px;"><span style="color: #3366ff;"><span style="color: #000000;">A lógica é simples, mas só se aplica quando decidimos fazer os testes porque queremos melhorar a qualidade do código e não porque fomos obrigados a fazê-los.</span></span></p>


<p style="padding-left: 30px;"><span style="color: #3366ff;"><span style="color: #000000;">A partir do momento que começamos a escrever testes unitários, olhamos para uma pequena porção isolada de código e pensamos em como ela pode falhar, somente então escrevemos o teste. É muito mais fácil pensar em como um método de 10 linhas pode falhar e testá-lo, do que executar um monte de telas para chegar no ponto que queremos testar.</span> </span></p>


<p><span style="color: #3366ff;"><span style="color: #000000;">Com certeza existem outros argumentos que caberiam para justificar os testes unitários, mas honestamente esses tem sido os principais que eu tenho visto desde que comecei a adotar a prática dos testes unitários. Espero que esse post lhe anime a estudar e iniciar essa prática, eu tenho convicção de que a sua vida será bem melhor no momento que você reduzir o seu tempo de debug. :&ndash;)</span></span></p>

<p>Ainda em tempo, existem diversos livros sobre testes unitários, um que eu li e realmente gostei foi esse <a href="http://www.amazon.com/Art-Unit-Testing-Examples-NET/dp/1933988274/ref=sr_1_1?ie=UTF8&amp;s=books&amp;qid=1257083405&amp;sr=8-1" target="_blank">The Art of Unit Testing</a>, infelizmente, apenas em inglês.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/25/adicionando-foreign-keys-no-rails/">Adicionando Foreign Keys no Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-25T00:00:00-04:00"  data-updated="true">25/10/2009</time>
        
         | <a href="/blog/2009/10/25/adicionando-foreign-keys-no-rails/#disqus_thread">Comentários</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Existem várias formas de se adicionar foreign keys no rails, mais uma das que eu acho mais simples é utilizando o plugin <a href="http://github.com/patientslikeme/migration_helpers">migration_helpers</a>.</p>

<p>A instalação funciona como qualquer outro plugin do rails:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>script/plugin install git://github.com/patientslikeme/migration_helpers.git
</span></code></pre></td></tr></table></div></figure>


<p>Depois disso edite seu arquivo de migração. Por exemplo, supondo que você tenha uma classe/tabela chamada Aluno e que esta tabela está relacionada a uma classe/tabela turma , para adicionar uma foreign key deve-se fazer o seguinte:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreateAlunos</span> <span class="o">&gt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'> <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>     <span class="n">create_table</span> <span class="ss">:alunos</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:nome</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">date</span> <span class="ss">:datanascimento</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:turma_id</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">add_foreign_key</span> <span class="ss">:alunos</span><span class="p">,</span> <span class="ss">:turma_id</span><span class="p">,</span> <span class="ss">:turmas</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">drop_table</span> <span class="ss">:sprints</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Quando rodar o rake db:migrate já será gerado o código SQL para a criação da foreign key no banco de dados.</p>

<p>Essa é somente uma funcionalidade do plugin migrate_helpers. Ele tem uma série de outros métodos muito legais como por exemplo para gravar dados para uma tabela.</p>

<p>Espero que tenha ajudado.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/26/publicando-um-site-octopress-usando-github-pages-em-uma-nova-maquina-de-dev/">Publicando um site Octopress usando GitHub pages a partir de um novo computador</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/25/instalando-uma-maquina-de-desenvolvimento-com-dois-comandos/">Instalando uma máquina de desenvolvimento com dois comandos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/30/responsabilidade-unica-com-javascript/">Só é uma bagunça se você deixar. Responsabilidade única com JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/23/meu-ted-talk-favorito/">Meu TED Talk favorito</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/16/programacao-orientada-a-coincidencia/">Programação orientada à coincidência</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Thiago Temple -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>


<script type="text/javascript">
var sc_project=5357260;
var sc_invisible=1;
var sc_security="14d7610a";
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" + scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web stats"
href="http://statcounter.com/free-web-stats/" target="_blank"><img
class="statcounter" src="http://c.statcounter.com/5357260/0/14d7610a/1/"
alt="web stats"></a></div></noscript>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'templecoding';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
